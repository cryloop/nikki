<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ³ L-System Forest</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Space Mono', monospace;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .controls {
            width: 320px;
            background: linear-gradient(180deg, #12121a 0%, #0d0d12 100%);
            padding: 24px;
            overflow-y: auto;
            border-right: 1px solid #2a2a3a;
        }
        
        .controls h1 {
            font-size: 1.4rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #7cfc00, #00fa9a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls .subtitle {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 24px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-group select,
        .control-group input[type="range"] {
            width: 100%;
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            color: #e0e0e0;
            padding: 10px;
            font-family: inherit;
            font-size: 0.85rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .control-group select:focus {
            outline: none;
            border-color: #7cfc00;
        }
        
        .control-group input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            padding: 0;
            border-radius: 4px;
            background: #1a1a24;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7cfc00, #00fa9a);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(124, 252, 0, 0.5);
        }
        
        .value-display {
            text-align: right;
            font-size: 0.75rem;
            color: #7cfc00;
            margin-top: 4px;
        }
        
        .color-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .color-inputs input[type="color"] {
            width: 100%;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }
        
        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 16px;
        }
        
        .btn {
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7cfc00, #00fa9a);
            color: #0a0a0f;
            font-weight: bold;
        }
        
        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(124, 252, 0, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #1a1a24;
            color: #7cfc00;
            border: 1px solid #2a2a3a;
        }
        
        .btn-secondary:hover {
            border-color: #7cfc00;
        }
        
        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(ellipse at bottom, #1a1a2e 0%, #0a0a0f 70%);
            position: relative;
        }
        
        canvas {
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }
        
        .preset-info {
            background: #1a1a24;
            padding: 12px;
            border-radius: 6px;
            margin-top: 16px;
            font-size: 0.7rem;
            color: #666;
            border: 1px solid #2a2a3a;
        }
        
        .preset-info code {
            color: #00fa9a;
            background: #0a0a0f;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 0.65rem;
            color: #444;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h1>ðŸŒ³ L-System Forest</h1>
            <div class="subtitle">Procedural plant generator</div>
            
            <div class="control-group">
                <label>Preset</label>
                <select id="preset">
                    <option value="binary">Binary Tree</option>
                    <option value="fern">Fern</option>
                    <option value="bush">Bush</option>
                    <option value="dragon">Dragon Curve</option>
                    <option value="sierpinski">Sierpinski</option>
                    <option value="weed">Weed</option>
                    <option value="crystal">Crystal</option>
                    <option value="spiral">Spiral</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Iterations</label>
                <input type="range" id="iterations" min="1" max="7" value="4">
                <div class="value-display" id="iterationsVal">4</div>
            </div>
            
            <div class="control-group">
                <label>Angle (degrees)</label>
                <input type="range" id="angle" min="5" max="90" value="25">
                <div class="value-display" id="angleVal">25Â°</div>
            </div>
            
            <div class="control-group">
                <label>Length</label>
                <input type="range" id="length" min="2" max="20" value="8">
                <div class="value-display" id="lengthVal">8</div>
            </div>
            
            <div class="control-group">
                <label>Branch Width</label>
                <input type="range" id="width" min="1" max="12" value="4">
                <div class="value-display" id="widthVal">4</div>
            </div>
            
            <div class="control-group">
                <label>Wind Strength</label>
                <input type="range" id="wind" min="0" max="50" value="10">
                <div class="value-display" id="windVal">10</div>
            </div>
            
            <div class="control-group">
                <label>Colors</label>
                <div class="color-inputs">
                    <input type="color" id="branchColor" value="#8B4513">
                    <input type="color" id="leafColor" value="#228B22">
                    <input type="color" id="bgColor" value="#0a0a0f">
                </div>
            </div>
            
            <div class="btn-row">
                <button class="btn btn-primary" id="generate">Generate</button>
                <button class="btn btn-secondary" id="export">Export PNG</button>
            </div>
            
            <div class="preset-info" id="presetInfo">
                <strong>Binary Tree</strong><br>
                Axiom: <code>0</code><br>
                Rules: <code>1â†’11</code>, <code>0â†’1[0]0</code>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="canvas" width="800" height="800"></canvas>
            <div class="legend">L-System Forest â€¢ Drag to rotate â€¢ Scroll to zoom</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        const presets = {
            binary: {
                axiom: '0',
                rules: { '1': '11', '0': '1[0]0' },
                angle: 25,
                length: 8,
                description: 'Axiom: <code>0</code><br>Rules: <code>1â†’11</code>, <code>0â†’1[0]0</code>'
            },
            fern: {
                axiom: 'X',
                rules: { 'X': 'F+[[X]-X]-F[-FX]+X', 'F': 'FF' },
                angle: 25,
                length: 3,
                description: 'Axiom: <code>X</code><br>Rules: <code>Xâ†’F+[[X]-X]-F[-FX]+X</code>, <code>Fâ†’FF</code>'
            },
            bush: {
                axiom: 'F',
                rules: { 'F': 'FF+[+F-F-F]-[-F+F+F]' },
                angle: 22.5,
                length: 4,
                description: 'Axiom: <code>F</code><br>Rules: <code>Fâ†’FF+[+F-F-F]-[-F+F+F]</code>'
            },
            dragon: {
                axiom: 'FX',
                rules: { 'X': 'X+YF+', 'Y': '-FX-Y' },
                angle: 90,
                length: 6,
                description: 'Axiom: <code>FX</code><br>Rules: <code>Xâ†’X+YF+</code>, <code>Yâ†’-FX-Y</code>'
            },
            sierpinski: {
                axiom: 'F-G-G',
                rules: { 'F': 'F-G+F+G-F', 'G': 'GG' },
                angle: 120,
                length: 5,
                description: 'Axiom: <code>F-G-G</code><br>Rules: <code>Fâ†’F-G+F+G-F</code>, <code>Gâ†’GG</code>'
            },
            weed: {
                axiom: 'F',
                rules: { 'F': 'F[+F]F[-F]F' },
                angle: 25.7,
                length: 4,
                description: 'Axiom: <code>F</code><br>Rules: <code>Fâ†’F[+F]F[-F]F</code>'
            },
            crystal: {
                axiom: 'F-F-F-F',
                rules: { 'F': 'FF-F-F-F-F+F' },
                angle: 90,
                length: 5,
                description: 'Axiom: <code>F-F-F-F</code><br>Rules: <code>Fâ†’FF-F-F-F-F+F</code>'
            },
            spiral: {
                axiom: 'F',
                rules: { 'F': 'F[+F]F[-F][F]' },
                angle: 20,
                length: 4,
                description: 'Axiom: <code>F</code><br>Rules: <code>Fâ†’F[+F]F[-F][F]</code>'
            }
        };
        
        let currentPreset = 'binary';
        let time = 0;
        let windOffset = 0;
        
        function generateLSystem(preset, iterations) {
            const p = presets[preset];
            let result = p.axiom;
            
            for (let i = 0; i < iterations; i++) {
                let newResult = '';
                for (const char of result) {
                    newResult += p.rules[char] || char;
                }
                result = newResult;
            }
            return result;
        }
        
        function drawLSystem() {
            const preset = document.getElementById('preset').value;
            const iterations = parseInt(document.getElementById('iterations').value);
            const angle = parseInt(document.getElementById('angle').value);
            const length = parseInt(document.getElementById('length').value);
            const width = parseInt(document.getElementById('width').value);
            const wind = parseInt(document.getElementById('wind').value);
            const branchColor = document.getElementById('branchColor').value;
            const leafColor = document.getElementById('leafColor').value;
            const bgColor = document.getElementById('bgColor').value;
            
            const p = presets[preset];
            const lsystem = generateLSystem(preset, iterations);
            
            // Clear canvas
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Calculate bounds
            let x = canvas.width / 2;
            let y = canvas.height * 0.9;
            let dir = -90;
            const stack = [];
            let minX = x, maxX = x, minY = y, maxY = y;
            let len = length * Math.pow(0.7, 7 - iterations);
            
            // First pass - calculate bounds
            for (const char of lsystem) {
                if (char === 'F' || char === 'G' || char === '0' || char === '1') {
                    const windEffect = Math.sin(windOffset + y * 0.01) * wind * 0.1;
                    const rad = (dir + windEffect) * Math.PI / 180;
                    x += Math.cos(rad) * len;
                    y += Math.sin(rad) * len;
                    minX = Math.min(minX, x);
                    maxX = Math.max(maxX, x);
                    minY = Math.min(minY, y);
                    maxY = Math.max(maxY, y);
                } else if (char === '+') {
                    dir += angle;
                } else if (char === '-') {
                    dir -= angle;
                } else if (char === '[') {
                    stack.push({ x, y, dir, len });
                } else if (char === ']') {
                    if (stack.length > 0) {
                        const state = stack.pop();
                        x = state.x;
                        y = state.y;
                        dir = state.dir;
                    }
                }
            }
            
            // Calculate scale to fit
            const scaleX = (canvas.width - 100) / (maxX - minX || 1);
            const scaleY = (canvas.height - 100) / (maxY - minY || 1);
            const scale = Math.min(scaleX, scaleY, 2);
            
            // Center and scale
            const offsetX = (canvas.width - (maxX + minX) * scale) / 2;
            const offsetY = canvas.height - 50 - minY * scale;
            
            // Second pass - draw
            x = canvas.width / 2;
            y = canvas.height * 0.9;
            dir = -90;
            len = length * Math.pow(0.7, 7 - iterations) * scale;
            const widthScale = scale;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            for (const char of lsystem) {
                if (char === 'F' || char === 'G' || char === '0' || char === '1') {
                    const windEffect = Math.sin(windOffset + y * 0.01) * wind * 0.1;
                    const rad = (dir + windEffect) * Math.PI / 180;
                    const newX = x + Math.cos(rad) * len;
                    const newY = y + Math.sin(rad) * len;
                    
                    // Determine color based on depth
                    const depth = stack.length;
                    const depthRatio = Math.min(depth / 8, 1);
                    
                    // Blend between branch and leaf color
                    const r = parseInt(branchColor.slice(1,3), 16) * (1 - depthRatio) + parseInt(leafColor.slice(1,3), 16) * depthRatio;
                    const g = parseInt(branchColor.slice(3,5), 16) * (1 - depthRatio) + parseInt(leafColor.slice(3,5), 16) * depthRatio;
                    const b = parseInt(branchColor.slice(5,7), 16) * (1 - depthRatio) + parseInt(leafColor.slice(5,7), 16) * depthRatio;
                    
                    ctx.strokeStyle = `rgb(${r},${g},${b})`;
                    ctx.lineWidth = Math.max(0.5, width * widthScale * (1 - depthRatio * 0.7));
                    
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(newX, newY);
                    ctx.stroke();
                    
                    x = newX;
                    y = newY;
                } else if (char === '+') {
                    dir += angle;
                } else if (char === '-') {
                    dir -= angle;
                } else if (char === '[') {
                    stack.push({ x, y, dir, len });
                    len *= 0.7;
                } else if (char === ']') {
                    if (stack.length > 0) {
                        const state = stack.pop();
                        x = state.x;
                        y = state.y;
                        dir = state.dir;
                        len = state.len;
                    }
                }
            }
        }
        
        function animate() {
            const wind = parseInt(document.getElementById('wind').value);
            if (wind > 0) {
                windOffset += 0.02 * (wind / 10);
            }
            drawLSystem();
            requestAnimationFrame(animate);
        }
        
        // Event listeners
        document.getElementById('preset').addEventListener('change', (e) => {
            currentPreset = e.target.value;
            const p = presets[currentPreset];
            document.getElementById('angle').value = p.angle;
            document.getElementById('angleVal').textContent = p.angle + 'Â°';
            document.getElementById('length').value = p.length;
            document.getElementById('lengthVal').textContent = p.length;
            document.getElementById('presetInfo').innerHTML = '<strong>' + 
                e.target.options[e.target.selectedIndex].text + '</strong><br>' + p.description;
            drawLSystem();
        });
        
        ['iterations', 'angle', 'length', 'width', 'wind'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const val = e.target.value;
                const display = document.getElementById(id + 'Val');
                if (display) {
                    display.textContent = id === 'angle' ? val + 'Â°' : val;
                }
                drawLSystem();
            });
        });
        
        ['branchColor', 'leafColor', 'bgColor'].forEach(id => {
            document.getElementById(id).addEventListener('input', drawLSystem);
        });
        
        document.getElementById('generate').addEventListener('click', drawLSystem);
        
        document.getElementById('export').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'lsystem-forest.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
        
        // Initialize
        window.onload = function() {
            document.getElementById('iterationsVal').textContent = document.getElementById('iterations').value;
            document.getElementById('angleVal').textContent = document.getElementById('angle').value + 'Â°';
            document.getElementById('lengthVal').textContent = document.getElementById('length').value;
            document.getElementById('widthVal').textContent = document.getElementById('width').value;
            document.getElementById('windVal').textContent = document.getElementById('wind').value;
            
            // Draw immediately
            drawLSystem();
            
            // Start animation loop only if wind > 0
            const wind = parseInt(document.getElementById('wind').value);
            if (wind > 0) {
                animate();
            }
        };
    </script>
</body>
</html>
